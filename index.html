<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Gopher Trapper</title>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
<meta name="theme-color" content="#4caf50"/>
<style>
:root{--green:#4caf50;--dark:#2f2f2f}
html,body{margin:0;height:100%;background:#7ec850;font-family:system-ui,-apple-system,Arial,sans-serif;overflow:hidden}
#screen{position:fixed;inset:0}
#hud{position:fixed;top:10px;left:10px;background:#fff;padding:10px;border-radius:12px;display:none}
#actionBtn{position:fixed;right:16px;bottom:16px;padding:14px 18px;border-radius:14px;border:none;background:var(--dark);color:#fff;font-weight:800}
#start{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(#7ec850,#a0d995)}
#card{background:#fff;padding:20px;border-radius:18px;text-align:center;width:min(90vw,420px)}
#card button{width:100%;margin-top:10px;padding:14px;border-radius:14px;border:none;background:var(--green);color:#fff;font-weight:800}
</style>
</head>
<body>

<div id="start">
  <div id="card">
    <h1>ü¶´ Gopher Trapper</h1>
    <p>v18 Clean Baseline</p>
    <button id="startBtn">Start New Game</button>
  </div>
</div>

<canvas id="screen"></canvas>
<div id="hud">üí∞ $<span id="money">0</span> | üï≥Ô∏è <span id="holes">0</span></div>
<button id="actionBtn" style="display:none">Action</button>

<script>
/* =====================
   Gopher Trapper v18
   Clean Baseline
   ===================== */

const SAVE_KEY = "gopherTrapper_v18";

const canvas = document.getElementById("screen");
const ctx = canvas.getContext("2d");
const hud = document.getElementById("hud");
const moneyEl = document.getElementById("money");
const holesEl = document.getElementById("holes");
const actionBtn = document.getElementById("actionBtn");

let save;

/* ---------- Save ---------- */
function newSave(){
  return {
    day:1,
    money:0,
    player:{x:400,y:300},
    lots:[],
    holes:[],
    contracts:{home:true}
  };
}

function saveGame(){
  localStorage.setItem(SAVE_KEY, JSON.stringify(save));
}

/* ---------- World ---------- */
function buildWorld(){
  save.lots = [
    {id:"home", x:200,y:200,w:300,h:200, holes:2},
    {id:"house1", x:600,y:200,w:300,h:200, holes:1},
    {id:"house2", x:200,y:500,w:300,h:200, holes:1},
    {id:"school", x:600,y:500,w:300,h:200, holes:1, civic:true}
  ];
}

function spawnHoles(){
  save.holes=[];
  for(const l of save.lots){
    const count = l.id==="home"?2:1;
    for(let i=0;i<count;i++){
      save.holes.push({
        lot:l.id,
        x:l.x+50+Math.random()*(l.w-100),
        y:l.y+50+Math.random()*(l.h-100)
      });
    }
  }
}

/* ---------- Rendering ---------- */
function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
window.addEventListener("resize", resize);

function draw(){
  ctx.fillStyle="#7ec850";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  for(const l of save.lots){
    ctx.fillStyle = l.civic ? "#d9d9d9" : "#d6a07a";
    ctx.fillRect(l.x,l.y,l.w,l.h);
    ctx.fillStyle="#000";
    ctx.fillText(l.id,l.x+10,l.y+20);
  }

  for(const h of save.holes){
    ctx.fillStyle="#5b3a1a";
    ctx.beginPath();
    ctx.ellipse(h.x,h.y+8,16,8,0,0,Math.PI*2);
    ctx.fill();
  }

  ctx.fillStyle="#000";
  ctx.beginPath();
  ctx.arc(save.player.x,save.player.y,10,0,Math.PI*2);
  ctx.fill();
}

/* ---------- Loop ---------- */
function loop(){
  draw();
  moneyEl.textContent = save.money;
  holesEl.textContent = save.holes.length;
  requestAnimationFrame(loop);
}

/* ---------- Start ---------- */
document.getElementById("startBtn").onclick = ()=>{
  save = newSave();
  buildWorld();
  spawnHoles();
  saveGame();
  document.getElementById("start").style.display="none";
  hud.style.display="block";
  actionBtn.style.display="block";
  resize();
  loop();
};
</script>

</body>
</html>
